# dahn - Deceptively Adaptive Honey Net

## TL;DR

What: LLM-based honeynet with dynamic adaptability 

Why: Why use 50 instances when you can use 1, with added flexibility?

## Description
Traditional honey nets offer static infrastructure and static responses. In DAHN, the infrastructure is abstracted, with lambda/gpt API (prompts stipulated) returning seemingly native responses to the threat actor, depending on the complexity index defined by the administrator. In other words, responses are dynamically crafted to entrap and retain threat actors, internal and external, in this environment for as long as possible, giving them a balance of false hope and realistic obstacles as they pass through our simulated layers of defense. Our AI-powered honey net mimics a given corporate environment to create a fictitious digital twin and embeds a controlled-level of simulated vulnerabilities/weaknesses to attract, distract, learn from, and attribute threat actors. The outputs are decoys, diversion, fingerprints, IoCs and IoAs, attributes, TTPs and behaviors, and used to augment threat detection and cyber defense strategies.

## Details
The tool comes with 3 main components:
1. The detection fingerprinter analyzes traffic and matches with malicious fingerprints to decide which traffic to route to the honeynet. 
1. The honeynet leverages on AI/LLM to simulate cli-responses from a fleet of machines that resembles the corporate environment. A series of networked machines are lined up virtually to contain the adversary and distract the adversary from the real targets. An attack-path-mapper presents a visual on the progress and current stage at which the adversary is at, which the blue team can monitor live.
1. The intel component collects TTPs, behaviors, fingerprints from the observed adversaries and converts them into internal intel for actions. There’s also a blue team module that can adaptively influence the adversaries’ movements. For instance, if the blue team wants to see TTPs and IoAs relating to databases, this module releases prompts to simulate vulnerable database instances to steer and lure the attacker into attempting to exploit. The intel module would then capture the on-demand and related behavioral attributes.

## Demo
### Session Manager

We simulate the exploitation of a session manager.
<img width="1395" alt="image" src="https://github.com/geo-chen/dahn/assets/2404584/06a65c70-3612-4f54-99c1-3a41afef5642">

On the left, we see the exploited session that bypasses authentication (simulated), and on the right, a benign session.

<img width="1408" alt="image" src="https://github.com/geo-chen/dahn/assets/2404584/ad3546b0-13fb-4bb2-8a2f-2e902deb5edd">

Because the exploited session runs in a known-malicious ja3 signature, dahn's fingerprinter routes that session to the honeynet (indicated with grey banner). In other words, legitimate sessions will interact with the intended service (indicated with blue banner), while malicious sessions matching our known-bad fingerprint signatures will be routed transparently to our digital twin/honeynet. 

The attacker might perform some enumeration activities, such as the ones listed below, and the responses are generated by LLM in a realistic manner (granted, more work needs to be done).
<img width="1503" alt="image" src="https://github.com/geo-chen/dahn/assets/2404584/ca2083d6-1891-4162-918f-d24f36486caf">


From host 1, the attacker is seen to have found an unguarded FTP service and has pivoted over. 

Once in, the attacker performs another round of enumeration and found AWS keys. Of course, the key generated here is deceptive. 
<img width="1504" alt="image" src="https://github.com/geo-chen/dahn/assets/2404584/fb9e5021-a7d3-462a-a55d-8c695bd775c7">

Attacker validates that the keys authenticate fine and attempts to enumerate:
<img width="1503" alt="image" src="https://github.com/geo-chen/dahn/assets/2404584/7853b056-372b-4bc8-ba29-62ab354f49c7">

Under the hood, the blue team sees the attacker activities in real-time and is able to influence the attack path - for instance, if the blue team wants to capture TTP relating to databases, they can inject a "vulnerable" database service at any given point in time.
<img width="1498" alt="image" src="https://github.com/geo-chen/dahn/assets/2404584/9b96cf2c-80ba-4bca-b42c-005f07f9cafa">

In the management console above, we see the fingerprint of the current attacker, beacon data from the AWS keys used earlier, an attack path, options for blue team influence (ie injecting vulnerable service), as well as LLM-generated insights that is then fed-back to the fingerprinter for actions (ie, more comprehensive filtering/routing or behaviorial-based blocking).

Going back to the attacker's session, and having a vulnerable DB service injected by the blue team earlier, when the attacker performs the same nmap enumeration, the attacker now sees a new vulnerable DB service being spun up. We also see here that dahn understands that this is a vulnerable DB service and thus allows the attacker to successfully exploit it. We then collect intel on the attacker's toolset and behavior which would help in crafting defenses and attribution.

<img width="1286" alt="image" src="https://github.com/geo-chen/dahn/assets/2404584/5a70673a-ef36-4e7c-b6d4-faed89289723">

## Architecture
![image](https://github.com/geo-chen/dahn/assets/2404584/c272d63b-8e86-4dcb-b346-a92181c8138a)

## Usage

Input your chatgpt API key into config.json.
```
sudo apt install nodejs
sudo npm install node-fetch
node --experimental-modules server.mjs
```

## Value
`low cost`
 - Infrastructure is lightweight
 - “Infrastructure” is also dynamic
 - Scalability is abstracted
 - Amplification on effort vs time wasted by adversaries

`adaptive`
 - Depending on how the attack progresses and what kinds of intel we want to collect, we shape the honeynet on-the-fly
 - Supports prompt as code where snippets of modular prompt can be injected, for instance, on a CVE. 
 - Adaptive yet consistent and realistic, with defense simulation (to-be)
 - No need to code out every granular scenario.

`internal intel`
 - Generates very relevant intel without paying the price of lessons learnt
 - Intel generated is automatically fed-back to the fingerprinter to redirect malicious actors to the honeynet.
 - Insights provided are translated into actionables

## Roadmap for 2024
 - Dynamic generation of network map based on organization profile, naming convention, and assets. 
 - Dynamic generation of decoys (canary API)
 - Moving to private/other GPT models
 - More robust fingerprinting engine with combined attributes
 - Building on service manager
 - Add in session aggregation for blue team monitoring
 - Excluder to migrate false positive sessions back to legitimate services
 - Make it harder to break the gpt-disguise

